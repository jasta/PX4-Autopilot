#!/bin/sh
# PX4 commands need the 'px4-' prefix in bash.
# (px4-alias.sh is expected to be in the PATH)
. px4-alias.sh

param select eeprom/parameters
param import

# system_power not implemented
param set CBRK_SUPPLY_CHK 894281

param set-default BAT1_V_DIV 10

# broadcast to LAN
# always keep current config
param set SYS_AUTOCONFIG 0
# useless but required for parameter completeness
set VEHICLE_TYPE rover
param set MAV_TYPE 11

param set SYS_AUTOSTART 50000

param set COM_RC_IN_MODE 1
param set SYS_HAS_BARO 0

param set MIS_LTRMIN_ALT 0.01
param set MIS_TAKEOFF_ALT 0.01

param set NAV_ACC_RAD 2
param set NAV_LOITER_RAD 2

param set SDLOG_MODE 1

# Uh, no idea why?
param set PWM_OUT 1234
param set PWM_MAIN_RATE 50
param set PWM_MAIN_MIN 1050
param set PWM_MAIN_MAX 1950
param set PWM_MAIN_DISARM 900

dataman start

load_mon start

#battery_status start

# internal IMU
mpu9250_i2c start -I -a 104
ak8963 start -I

# PWM
pca9685_pwm_out start -a 112
mixer load /dev/pwm_output0 etc/mixers/rover_diff_and_servo.main.mix

# external GPS & compass
gps start -d /dev/ttyUSB0 -i uart -p nmea

sensors start
commander start
navigator start
ekf2 start
control_allocator start
rover_pos_control start
land_detector start rover
flight_mode_manager start

mavlink start -x -u 14556 -r 1000000 -p

# Telem
#mavlink start -x -Z -d /dev/ttySC1

logger start -t -b 200

mavlink boot_complete
